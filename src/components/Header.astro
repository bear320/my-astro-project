---
import { Icon } from 'astro-icon/components';

const { pathname } = Astro.url;

const currentLang = Astro.currentLocale === 'zh-TW' ? 'zh-TW' : 'en';

const navMap = {
  'zh-TW': [
    { href: '/about', text: '關於我們' },
    { href: '/products', text: '產品' },
    { href: '/contact', text: '聯絡我們' },
  ],
  en: [
    { href: '/en/about', text: 'About' },
    { href: '/en/products', text: 'Products' },
    { href: '/en/contact', text: 'Contact' },
  ],
};

const navLinks = navMap[currentLang];

const switchLangPath =
  currentLang === 'zh-TW' ? `/en${pathname === '/' ? '' : pathname}` : pathname.replace(/^\/en/, '') || '/';

// const isActive = (path: string) =>
//   pathname === path || (pathname.startsWith(path + '/') && pathname.split('/')[1] === path.replace('/', ''));
---

<header class="sticky top-0 z-10 w-full bg-[f5f5f5]/50 shadow-lg backdrop-blur-md">
  <input type="checkbox" id="menu-toggle" class="peer/menu hidden" />

  <div class="mx-auto flex w-full max-w-5xl items-center justify-between px-4 py-2">
    <a href={currentLang === 'zh-TW' ? '/' : '/en/'}>
      <img src="https://dummyimage.com/80x40/777777/ffffff&text=LOGO" alt="LOGO" />
    </a>

    <nav class="hidden lg:flex lg:items-center lg:gap-4">
      {
        navLinks.map((link) => (
          <a href={link.href} class={`hover:underline focus:underline active:underline`}>
            {link.text}
          </a>
        ))
      }
      <a href={switchLangPath} class="rounded border px-2 py-1 text-sm">
        {currentLang === 'zh-TW' ? 'English' : '繁體中文'}
      </a>
    </nav>

    <label for="menu-toggle" class="lg:hidden" aria-controls="mobile-menu" aria-expanded="false">
      <Icon name="ion:menu-outline" size="24" class={`cursor-pointer lg:hidden`} />
    </label>
  </div>

  <nav
    class="absolute top-full z-10 hidden w-full gap-4 bg-white p-4 text-center shadow-lg peer-checked/menu:grid lg:hidden"
  >
    {
      navLinks.map((link) => (
        <a href={link.href} class="mx-auto w-fit text-center">
          {link.text}
        </a>
      ))
    }
    <a href={switchLangPath} class="mx-auto w-fit rounded border px-2 py-1 text-sm">
      {currentLang === 'zh-TW' ? 'English' : '繁體中文'}
    </a>
  </nav>
</header>

<script>
  if (typeof window !== 'undefined') {
    const mq = window.matchMedia('(min-width: 768px)');
    const menuToggle = document.getElementById('menu-toggle') as HTMLInputElement;

    mq.addEventListener('change', (e) => {
      if (e.matches && menuToggle) {
        menuToggle.checked = false;
      }
    });
  }
</script>
